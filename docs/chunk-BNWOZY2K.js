import{a as Ce}from"./chunk-2DHMM5YC.js";import{b as be,c as ve}from"./chunk-UOQMXM2V.js";import{a as ae,b as S,c as le,d as se,e as me,f as v,g as ce,i as de,j as pe,k as ue,l as fe,m as xe,n as he,o as ge}from"./chunk-XED3NCHW.js";import{a as Se,b as _e}from"./chunk-G3OQY22M.js";import{$ as u,A as N,Aa as P,Bb as te,C as B,Ca as T,Cb as ie,D as j,Db as ne,E as n,Eb as oe,F as y,Hb as re,M as h,Ma as A,P as a,W as t,Wa as G,X as i,Y as g,Z as _,aa as p,ba as L,ca as U,cb as I,da as R,db as H,fb as $,hb as J,ib as Q,ja as l,ka as C,la as b,p as F,qa as O,sb as Y,tb as K,u as f,ub as W,v as x,vb as X,w as z,wb as Z,yb as ee,za as q}from"./chunk-L4M4Q24E.js";import"./chunk-Z6EQZUNN.js";var D=class{constructor(m,e,s,r,c,d){this.id=m,this.pedido,this.descripcion=s,this.cantidad=r,this.precio=c,this.producto=d}};var k=class{constructor(m,e,s,r,c,d,E,w,M,V){this.id=m,this.estado=e,this.nombres=s,this.apellidos=r,this.telefono=c,this.departamento=d,this.sucursal=E,this.metodoPago=w,this.detallePedido=M,this.total=V}};var Pe=["*"];function Te(o,m){if(o&1){let e=_();t(0,"button",7),u("click",function(){f(e);let r=p();return x(r.onSubmit())}),l(1,"Aceptar"),i()}if(o&2){let e=p();a("disabled",e.disabledSubmit)}}var Ee=(()=>{let m=class m{constructor(){this.close=new N,this.submit=new N}ngOnInit(){}onSubmit(){this.submit.emit()}onClose(){this.close.emit()}};m.\u0275fac=function(r){return new(r||m)},m.\u0275cmp=F({type:m,selectors:[["app-modal-crud"]],inputs:{showModal:"showModal",showSubmit:"showSubmit",tittle:"tittle",disabledSubmit:"disabledSubmit",disabledOthersButtons:"disabledOthersButtons"},outputs:{close:"close",submit:"submit"},standalone:!0,features:[O],ngContentSelectors:Pe,decls:12,vars:5,consts:[["staticBackdropModal",""],["backdrop","static","alignment","center",3,"visible"],["backdrop","static","id","staticBackdropModal"],["cModalTitle",""],["cButtonClose","",3,"click","disabled"],["cButton","","color","secondary",3,"click","disabled"],["cButton","","style","background-color: rgb(0, 179, 186); border: none;",3,"disabled","click",4,"ngIf"],["cButton","",2,"background-color","rgb(0, 179, 186)","border","none",3,"click","disabled"]],template:function(r,c){if(r&1){let d=_();L(),t(0,"c-modal",1)(1,"c-modal-header",2,0)(3,"h5",3),l(4),i(),t(5,"button",4),u("click",function(){return f(d),x(c.onClose())}),i()(),t(6,"c-modal-body"),U(7),i(),t(8,"c-modal-footer")(9,"button",5),u("click",function(){return f(d),x(c.onClose())}),l(10," Cancelar "),i(),h(11,Te,2,1,"button",6),i()()}r&2&&(a("visible",c.showModal),n(4),C(c.tittle),n(),a("disabled",c.disabledOthersButtons),n(4),a("disabled",c.disabledOthersButtons),n(2),a("ngIf",c.showSubmit))},dependencies:[T,P,oe,ne,te,ie,I,H]});let o=m;return o})();function Ie(o,m){if(o&1){let e=_();t(0,"tr")(1,"td",20),g(2,"img",21),i(),t(3,"td",20),l(4),i(),g(5,"td",22),t(6,"td",20),l(7),i(),t(8,"td",20),l(9),i(),t(10,"td",20),l(11),i(),t(12,"td",20)(13,"button",23),u("click",function(){let r=f(e).$implicit,c=p(2);return x(c.eliminar(r.producto.id))}),z(),g(14,"svg",24),i()()()}if(o&2){let e=m.$implicit,s=p(2);n(2),a("src",e.producto.imagen,j),n(2),C(e.producto.nombre),n(),a("innerHTML",e.descripcion,B),n(2),C(e.cantidad),n(2),b("Q",s.functionsUtils.formatPrice(e.producto.precio),""),n(2),b("Q",s.functionsUtils.formatPrice(e.producto.precio*e.cantidad),"")}}function De(o,m){o&1&&(t(0,"c-form-feedback",30),l(1,"Campo requerido."),i()),o&2&&a("valid",!1)}function ke(o,m){o&1&&(t(0,"c-form-feedback",30),l(1,"Solo se permiten valores num\xE9ricos del 0 al 9 con longitud m\xE1xima de 8 car\xE1cteres"),i()),o&2&&a("valid",!1)}function Ne(o,m){if(o&1&&(t(0,"option",43),l(1),i()),o&2){let e=m.$implicit,s=p(3);a("value",e.codigo),n(),b(" ",s.dataUtils.descripcionPorCodigo(e.codigo)," ")}}function Ve(o,m){if(o&1&&(t(0,"option",43),l(1),i()),o&2){let e=m.$implicit;a("value",e.id),n(),b(" ",e.nombre," ")}}function ze(o,m){if(o&1&&(t(0,"option",43),l(1),i()),o&2){let e=m.$implicit;a("value",e.id),n(),b(" ",e.nombre," ")}}function Be(o,m){if(o&1){let e=_();t(0,"form",25)(1,"div",9)(2,"span",10),l(3,"Datos personales"),i()(),g(4,"br"),t(5,"c-input-group",26)(6,"div",27)(7,"input",28),u("blur",function(){f(e);let r=p(2);return x(r.functionsUtils.removeSpaces("nombres",r.form))}),i(),t(8,"label",29),l(9,"Nombres*"),i(),t(10,"c-form-feedback",30),l(11,"Campo requerido."),i()()(),t(12,"c-input-group",26)(13,"div",27)(14,"input",31),u("blur",function(){f(e);let r=p(2);return x(r.functionsUtils.removeSpaces("apellidos",r.form))}),i(),t(15,"label",32),l(16,"Apellidos*"),i(),t(17,"c-form-feedback",30),l(18,"Campo requerido."),i()()(),t(19,"c-input-group",26)(20,"div",27)(21,"input",33),u("blur",function(){f(e);let r=p(2);return x(r.functionsUtils.removeSpaces("telefono",r.form))}),i(),t(22,"label",34),l(23,"Tel\xE9fono*"),i(),h(24,De,2,1,"c-form-feedback",35)(25,ke,2,1,"c-form-feedback",35),i()(),t(26,"div",9)(27,"span",10),l(28,"Datos de env\xEDo"),i()(),g(29,"br"),t(30,"c-input-group",26)(31,"div",27)(32,"select",36),u("change",function(){f(e);let r=p(2);return x(r.filtrarLista())}),h(33,Ne,2,2,"option",37),i(),t(34,"label",38),l(35,"Departamento*"),i(),t(36,"c-form-feedback",30),l(37,"Campo requerido."),i()()(),t(38,"c-input-group",26)(39,"div",27)(40,"select",39),h(41,Ve,2,2,"option",37),i(),t(42,"label",40),l(43,"Sucursal*"),i(),t(44,"c-form-feedback",30),l(45,"Campo requerido."),i()()(),t(46,"c-input-group",26)(47,"div",27)(48,"select",41),h(49,ze,2,2,"option",37),i(),t(50,"label",42),l(51,"M\xE9todo de pago*"),i(),t(52,"c-form-feedback",30),l(53,"Campo requerido."),i()()()()}if(o&2){let e=p(2);a("formGroup",e.form),n(6),a("cFormFloating",!0),n(),a("valid",e.functionsUtils.campoRequerido(e.form,"nombres","CR")==1?!1:null)("maxLength",70),n(3),a("valid",!1),n(3),a("cFormFloating",!0),n(),a("valid",e.functionsUtils.campoRequerido(e.form,"apellidos","CR")==1?!1:null)("maxLength",60),n(3),a("valid",!1),n(3),a("cFormFloating",!0),n(),a("valid",e.functionsUtils.campoRequerido(e.form,"telefono","CR")==1||e.functionsUtils.campoRequerido(e.form,"telefono","TI")==3?!1:null)("maxLength",8),n(3),a("ngIf",e.functionsUtils.getValueMap("telefono")==1),n(),a("ngIf",e.functionsUtils.getValueMap("telefono")==3),n(6),a("cFormFloating",!0),n(2),a("ngForOf",e.dataUtils.listaDepartamentos),n(3),a("valid",!1),n(3),a("cFormFloating",!0),n(2),a("ngForOf",e.listaSucursalesFiltrada),n(3),a("valid",!1),n(3),a("cFormFloating",!0),n(2),a("ngForOf",e.listaMetodoPago),n(3),a("valid",!1)}}function je(o,m){if(o&1){let e=_();t(0,"c-card",8)(1,"div",9)(2,"span",10),l(3,"Carrito"),i()(),t(4,"c-card-body")(5,"c-container")(6,"div",11)(7,"table",12)(8,"thead")(9,"tr"),g(10,"th",13),t(11,"th",13),l(12,"Nombre de producto"),i(),t(13,"th",13),l(14,"Descripci\xF3n"),i(),t(15,"th",13),l(16,"Cantidad"),i(),t(17,"th",13),l(18,"Precio"),i(),t(19,"th",13),l(20,"Total"),i(),g(21,"th",13),i()(),t(22,"tbody"),h(23,Ie,15,6,"tr",14),g(24,"td")(25,"td")(26,"td")(27,"td"),t(28,"td",7),l(29,"Total de compra: "),i(),t(30,"td",15),l(31),i()()()()()(),t(32,"c-card-body",3)(33,"div",16),h(34,Be,54,23,"form",17),i()(),t(35,"div",18)(36,"button",19),u("click",function(){f(e);let r=p();return x(r.realizarCompra())}),l(37," Finalizar Compra "),i()()()}if(o&2){let e=p();n(7),a("striped",!0),n(16),a("ngForOf",e.listResponse),n(8),b("Q",e.functionsUtils.formatPrice(e.totalCompra),""),n(3),a("ngIf",e.form),n(2),a("disabled",!e.form||e.form&&e.form.invalid||e.deshabilitarBotones)}}function Le(o,m){o&1&&(t(0,"c-card",8)(1,"c-card-body",44)(2,"h4"),l(3,"No existen productos en el carrito de compras"),i()()())}function Ue(o,m){if(o&1&&(t(0,"c-alert",45),l(1),i()),o&2){let e=p();R("color",e.type),n(),C(e.mensaje)}}function Re(o){let m=o.value;return/^[0-9\s]+$/.test(m)?null:{onlyNumbersAndSpaces:!0}}var vt=(()=>{let m=class m{constructor(s,r,c,d){this.functionsUtils=s,this.services=r,this.dataUtils=c,this.router=d,this.mapaProductos={},this.listaMetodoPago=[{id:"E",nombre:"Pago contra entrega"}],this.deshabilitarBotones=!1,this.mostrarMensaje=!1,this.listResponse=[],this.type="",this.mensaje="",this.mostrarMensaje=!1,this.deshabilitarBotones=!1}ngOnInit(){this.services.isDashboardUrl=!1,this.totalCompra=0,this.cargarMapaDesdeLocalStorage(),this.services.mostrarSpinner=!1,this.form=new me({nombres:new v("",S.required),apellidos:new v("",S.required),telefono:new v("",[S.required,Re,S.minLength(8)]),departamento:new v("",S.required),sucursal:new v("",S.required),metodoPago:new v("E",S.required)}),this.form.controls.departamento.setValue("1"),this.services.getAllItemsFromEntity("sucursales").subscribe(s=>{this.listaSucursales=s,this.filtrarLista()},s=>{console.error(s)})}realizarCompra(){this.services.mostrarSpinner=!0,this.form.controls.metodoPago.value==="E"?(this.mostrarModal=!0,this.services.mostrarSpinner=!1):this.form.controls.metodoPago.value}mostrarModalMetodoPago(){}finalizarCompra(){this.deshabilitarBotones=!0;let s=this.listaSucursalesFiltrada&&this.listaSucursalesFiltrada.length>0?this.listaSucursalesFiltrada.find(d=>d.id===Number(this.form.controls.sucursal.value)):null,r=JSON.parse(JSON.stringify(this.listResponse));r&&r.forEach(d=>{d.producto.imagen="",d.producto.imageSrc=""});let c=new k(null,"N",this.form.controls.nombres.value,this.form.controls.apellidos.value,this.form.controls.telefono.value,this.form.controls.departamento.value,s,this.form.controls.metodoPago.value,r,this.totalCompra);this.services.saveEntity("pedidos",c).subscribe(d=>{this.type=d.error?"danger":"success",this.mensaje=d.mensaje,this.mostrarMensaje=!0,this.services.mostrarSpinner=!1,setTimeout(()=>{this.mostrarMensaje=!1,this.deshabilitarBotones=!d.error,d.error||(localStorage.removeItem("mapaProductos"),this.cargarMapaDesdeLocalStorage(),this.functionsUtils.navigateOption(this.router,"",new class{}))},2e3)},d=>{this.deshabilitarBotones=!1,this.services.mostrarSpinner=!1,this.type="danger",this.mensaje="Ha ocurrido un error al insertar los datos",this.mostrarMensaje=!0,setTimeout(()=>{this.mostrarMensaje=!1},1500),console.error("Error al consumir Post")})}eliminar(s){this.mapaProductos[s]&&(delete this.mapaProductos[s],this.guardarMapaEnLocalStorage())}guardarMapaEnLocalStorage(){localStorage.setItem("mapaProductos",JSON.stringify(this.mapaProductos)),this.cargarMapaDesdeLocalStorage()}cargarMapaDesdeLocalStorage(){this.services.cantidadProductosCarrito=0,this.totalCompra=0,this.listResponse=[];let s=localStorage.getItem("mapaProductos");if(s){this.mapaProductos=JSON.parse(s);let c=Object.keys(this.mapaProductos).length;this.services.cantidadProductosCarrito=c;for(let d in this.mapaProductos)if(this.mapaProductos.hasOwnProperty(d)){let E=this.mapaProductos[d].cantidad,w=this.mapaProductos[d].producto,M=this.mapaProductos[d].caracteristicas;var r=w.descripcion;M&&(r+='<br><span class="fw-bold"> Caracter\xEDsticas:</span> ',Object.entries(M).forEach(([ye,Me])=>{r+=' <br><span class="fw-semibold">'+ye+": </span>"+Me+","}),r=r.substring(0,r.length-1));let we=new D(null,null,r,E,w.precio,w);this.listResponse.push(we),this.totalCompra+=Number(E*w.precio)}}}filtrarLista(){this.form.controls.sucursal.setValue(null),this.listaSucursalesFiltrada=this.listaSucursales.filter(s=>s.departamento===this.form.controls.departamento.value),this.listaSucursalesFiltrada&&this.listaSucursalesFiltrada.length>0&&this.form.controls.sucursal.setValue(this.listaSucursalesFiltrada[0].id)}closeModal(){this.mostrarModal=!1}resetFormMetodoPago(){}confirmarCompra(){this.services.mostrarSpinner=!0,this.deshabilitarBotones=!0,this.finalizarCompra()}};m.\u0275fac=function(r){return new(r||m)(y(Se),y(_e),y(Ce),y(A))},m.\u0275cmp=F({type:m,selectors:[["app-carrito-compras"]],standalone:!0,features:[O],decls:12,vars:9,consts:[[1,"d-flex","justify-content-center","flex-column","align-items-center"],["class","my-5 ancho-personalizado",4,"ngIf"],[3,"close","submit","showModal","tittle","disabledSubmit","disabledOthersButtons","showSubmit"],[1,"d-flex","justify-content-center"],[1,"col-10"],[3,"color",4,"ngIf"],["color","warning"],[1,"fw-bold"],[1,"my-5","ancho-personalizado"],[1,"d-flex","justify-content-center","mt-3"],[1,"tittle"],[1,"text-center","scroll"],["cTable","",3,"striped"],["scope","col"],[4,"ngFor","ngForOf"],[1,"align-center","fw-bold"],[1,"col-6"],["cForm","",3,"formGroup",4,"ngIf"],[1,"justify-content-center","d-flex","mt-2",2,"padding-bottom","20px"],["cButton","","color","primary",1,"boton-comprar",3,"click","disabled"],[1,"align-center"],["cCardImg","top",1,"fixed-size-img",3,"src"],[1,"text-start",3,"innerHTML"],["cButton","","color","danger","variant","outline","size","sm",3,"click"],["cIcon","","name","cilTrash"],["cForm","",3,"formGroup"],[1,"mb-2"],[3,"cFormFloating"],["id","nombres","autoComplete","name","cFormControl","","placeholder","Nombres","formControlName","nombres",3,"blur","valid","maxLength"],["cLabel","","for","nombres"],[3,"valid"],["id","apellidos","autoComplete","name","cFormControl","","placeholder","Apellidos","formControlName","apellidos",3,"blur","valid","maxLength"],["cLabel","","for","apellidos"],["id","telefono","autoComplete","telefono","cFormControl","","placeholder","Tel\xE9fono","formControlName","telefono",3,"blur","valid","maxLength"],["cLabel","","for","telefono"],[3,"valid",4,"ngIf"],["id","departamento","cSelect","","formControlName","departamento",3,"change"],[3,"value",4,"ngFor","ngForOf"],["cLabel","","for","departamento",2,"margin-top","-5px"],["id","sucursal","cSelect","","formControlName","sucursal"],["cLabel","","for","sucursal",2,"margin-top","-5px"],["id","metodoPago","cSelect","","formControlName","metodoPago"],["cLabel","","for","metodoPago",2,"margin-top","-5px"],[3,"value"],[1,"d-flex","justify-content-center","flex-column","align-items-center","align-content-center"],[3,"color"]],template:function(r,c){r&1&&(t(0,"div",0),h(1,je,38,5,"c-card",1)(2,Le,4,0,"c-card",1),i(),t(3,"app-modal-crud",2),u("close",function(){return c.closeModal()})("submit",function(){return c.confirmarCompra()}),t(4,"div",3)(5,"div",4),h(6,Ue,2,2,"c-alert",5),t(7,"c-alert",6)(8,"span",7),l(9,"Nota:"),i(),l(10),i()()()(),g(11,"app-custom-spinner")),r&2&&(n(),a("ngIf",c.listResponse&&c.listResponse.length>0),n(),a("ngIf",!c.listResponse||c.listResponse&&c.listResponse.length===0),n(),a("showModal",c.mostrarModal)("tittle","Confirmar compra")("disabledSubmit",c.form.invalid||c.deshabilitarBotones)("disabledOthersButtons",c.deshabilitarBotones)("showSubmit",!0),n(3),a("ngIf",c.mostrarMensaje),n(4),C("Los pedidos realizados tardan de 2 a 3 d\xEDas en ser entregados"))},dependencies:[J,Q,I,ve,be,T,q,P,X,ge,ce,fe,xe,ae,ue,le,se,de,pe,G,$,ee,Y,Z,he,re,K,W,Ee],styles:['@charset "UTF-8";.boton-comprar[_ngcontent-%COMP%]{background-color:#00b3ba!important;border-color:#00b3ba!important}.ancho-personalizado[_ngcontent-%COMP%]{width:70%}.tittle[_ngcontent-%COMP%]{color:#0009;font-size:25px;margin-bottom:55px}.fixed-size-img[_ngcontent-%COMP%]{width:12vw;height:20vh}.align-center[_ngcontent-%COMP%]{text-align:center!important;vertical-align:middle!important}.col-2[_ngcontent-%COMP%], .col-4[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.scroll[_ngcontent-%COMP%]{max-height:70vh;overflow:scroll}@media only screen and (max-width: 767px){.tittle[_ngcontent-%COMP%]{color:#0009;font-size:25px;margin-bottom:0}td[_ngcontent-%COMP%]{word-wrap:break-word;min-width:35vw;max-width:80vw}.fixed-size-img[_ngcontent-%COMP%]{width:30vw;height:20vh}}@media only screen and (min-width: 768px) and (max-width: 1023px){.tittle[_ngcontent-%COMP%]{color:#0009;font-size:25px;margin-bottom:0}td[_ngcontent-%COMP%]{word-wrap:break-word;min-width:15vw;width:auto;max-width:28vw}.fixed-size-img[_ngcontent-%COMP%]{width:25vw;height:18vh}}@media only screen and (min-width: 1024px){.tittle[_ngcontent-%COMP%]{color:#0009;font-size:25px;margin-bottom:0}td[_ngcontent-%COMP%]{word-wrap:break-word;min-width:10vw;width:auto;max-width:15vw}.fixed-size-img[_ngcontent-%COMP%]{width:13vw;height:15vh}}']});let o=m;return o})();export{vt as CarritoComprasComponent};
